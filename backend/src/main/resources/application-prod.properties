# ============================================
# PRODUCTION PROFILE - application-prod.properties
# ============================================
# Activate with: --spring.profiles.active=prod
# Or env var: SPRING_PROFILES_ACTIVE=prod
# ============================================

# ============================================
# DATABASE - Use env vars, no hardcoded creds
# ============================================
spring.datasource.url=${DB_URL}
spring.datasource.username=${DB_USERNAME}
spring.datasource.password=${DB_PASSWORD}

# Connection pool tuning (HikariCP defaults)
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.max-lifetime=1200000

# ============================================
# JPA / HIBERNATE - PRODUCTION SAFE
# ============================================
# CRITICAL: validate only - never alter schema automatically
spring.jpa.hibernate.ddl-auto=validate

# CRITICAL: disable SQL logging in production
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.use_sql_comments=false

# Disable Open Session in View
spring.jpa.open-in-view=false

# ============================================
# LOGGING - PRODUCTION LEVELS
# ============================================
# Application: WARN to reduce noise
logging.level.com.cityatlas.backend=WARN

# CRITICAL: Disable Hibernate SQL and parameter logging
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN

# Security: INFO for audit trail
logging.level.org.springframework.security=WARN

# Cache: WARN only
logging.level.org.springframework.cache=WARN

# Structured logging pattern for log aggregators
logging.pattern.console=%d{ISO8601} [%thread] %-5level %logger{36} - %msg%n

# ============================================
# CACHE - Caffeine with TTL
# ============================================
spring.cache.type=caffeine
spring.cache.caffeine.spec=maximumSize=1000,expireAfterWrite=15m

# ============================================
# ACTUATOR - Health & Metrics
# ============================================
management.endpoints.web.exposure.include=health,info,metrics,caches
management.endpoint.health.show-details=when-authorized
management.endpoint.health.probes.enabled=true

# Kubernetes-compatible liveness/readiness
management.health.livenessstate.enabled=true
management.health.readinessstate.enabled=true

# Info endpoint
management.info.env.enabled=true
info.app.name=CityAtlas Backend API
info.app.version=0.0.1-SNAPSHOT
info.app.description=City analytics and insights platform

# ============================================
# SECURITY - Production CORS
# ============================================
# Override CORS origins via env var in production
cityatlas.cors.allowed-origins=${CITYATLAS_CORS_ALLOWED_ORIGINS:https://cityatlas.example.com}

# ============================================
# EXTERNAL APIs - Must use real env vars
# ============================================
cityatlas.external.openweather.api-key=${OPENWEATHER_API_KEY}
cityatlas.external.openaq.api-key=${OPENAQ_API_KEY}
cityatlas.external.spotify.client-id=${SPOTIFY_CLIENT_ID}
cityatlas.external.spotify.client-secret=${SPOTIFY_CLIENT_SECRET}
cityatlas.external.unsplash.access-key=${UNSPLASH_ACCESS_KEY}

# Stricter timeouts for production
cityatlas.external.timeout.connection-ms=3000
cityatlas.external.timeout.read-ms=8000
cityatlas.external.retry.max-attempts=2
cityatlas.external.retry.backoff-ms=500
