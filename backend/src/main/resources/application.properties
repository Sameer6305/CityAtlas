# ============================================
# APPLICATION CONFIGURATION
# ============================================
spring.application.name=CityAtlas Backend API
server.port=8080
server.servlet.context-path=/api

# Disable Kafka for local development (no Kafka server running)
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.kafka.KafkaAutoConfiguration

# Import additional property sources
# application-secrets.properties contains sensitive API keys and credentials
# This file should NOT be committed to version control
spring.config.import=optional:classpath:application-secrets.properties

# ============================================
# POSTGRESQL DATABASE CONFIGURATION
# ============================================
# Database connection URL
# Format: jdbc:postgresql://hostname:port/database_name
spring.datasource.url=${DB_URL:jdbc:postgresql://localhost:5434/cityatlas}

# Database credentials
spring.datasource.username=${DB_USERNAME:postgres}
spring.datasource.password=${DB_PASSWORD:postgres}

# PostgreSQL driver class (auto-detected, but explicit is better)
spring.datasource.driver-class-name=org.postgresql.Driver

# ============================================
# JPA / HIBERNATE CONFIGURATION
# ============================================
# Schema validation strategy
# Options:
# - validate: Validate schema, make no changes to database (RECOMMENDED for production)
# - update: Update schema if needed (use with caution)
# - create: Create schema, destroy previous data
# - create-drop: Create schema on start, drop on shutdown (testing only)
# - none: Disable DDL handling
spring.jpa.hibernate.ddl-auto=update

# Show SQL queries in console
# Set to true only via application-dev.properties or env var SPRING_JPA_SHOW_SQL=true
spring.jpa.show-sql=false

# Format SQL output for readability
spring.jpa.properties.hibernate.format_sql=false

# PostgreSQL dialect for Hibernate
# Enables PostgreSQL-specific features and optimizations
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

# Disable Open Session in View (OSIV)
# OSIV can cause performance issues and unexpected lazy loading
# Better to fetch data explicitly in service layer
spring.jpa.open-in-view=false

# Generate better SQL comments for debugging (dev only)
spring.jpa.properties.hibernate.use_sql_comments=false

# ============================================
# LOGGING CONFIGURATION
# ============================================
# Application logging level
logging.level.com.cityatlas.backend=INFO

# Hibernate SQL logging — use DEBUG only in application-dev.properties
logging.level.org.hibernate.SQL=WARN

# Hibernate parameter values logging — TRACE leaks sensitive data, keep WARN
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN

# Spring Security logging
logging.level.org.springframework.security=INFO

# Console output pattern
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %logger{36} - %msg%n

# ============================================
# SECURITY - CORS
# ============================================
# Comma-separated list of allowed frontend origins.
# Override in production via env var:
#   CITYATLAS_CORS_ALLOWED_ORIGINS=https://yourdomain.com
cityatlas.cors.allowed-origins=${CITYATLAS_CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:3001}

# ============================================
# SPRING BOOT ACTUATOR
# ============================================
management.endpoints.web.exposure.include=health,info,metrics,caches
management.endpoint.health.show-details=when-authorized
management.endpoint.health.probes.enabled=true
management.health.livenessstate.enabled=true
management.health.readinessstate.enabled=true

# ============================================
# EXTERNAL API CONFIGURATION
# ============================================
# IMPORTANT: These are PLACEHOLDER values only - DO NOT commit real API keys!
# Set actual values via environment variables in production.
#
# Environment variable mapping:
# - cityatlas.external.openweather.api-key -> OPENWEATHER_API_KEY
# - cityatlas.external.openaq.api-key -> OPENAQ_API_KEY
# - cityatlas.external.spotify.client-id -> SPOTIFY_CLIENT_ID
# - cityatlas.external.spotify.client-secret -> SPOTIFY_CLIENT_SECRET
# - cityatlas.external.unsplash.access-key -> UNSPLASH_ACCESS_KEY
#
# Example: export OPENWEATHER_API_KEY=your_actual_key_here
# Or in application-prod.properties: cityatlas.external.openweather.api-key=${OPENWEATHER_API_KEY}

# OpenWeatherMap API - Weather data integration
# Sign up at: https://openweathermap.org/api
# Used for: Real-time weather, forecasts, air quality
cityatlas.external.openweather.api-key=${OPENWEATHER_API_KEY:placeholder-openweather-key}
cityatlas.external.openweather.base-url=https://api.openweathermap.org/data/2.5

# OpenAQ API - REPLACED by Open-Meteo (free, no key required)
# Open-Meteo AQ: https://air-quality-api.open-meteo.com/v1/air-quality
# Open-Meteo Geo: https://geocoding-api.open-meteo.com/v1/search
# cityatlas.external.openaq.api-key=${OPENAQ_API_KEY:placeholder-openaq-key}
# cityatlas.external.openaq.base-url=https://api.openaq.org/v3

# Spotify API - Music and culture data integration
# Sign up at: https://developer.spotify.com/dashboard
# Used for: Local music scene, cultural events, playlists
cityatlas.external.spotify.client-id=${SPOTIFY_CLIENT_ID:placeholder-spotify-client-id}
cityatlas.external.spotify.client-secret=${SPOTIFY_CLIENT_SECRET:placeholder-spotify-secret}
cityatlas.external.spotify.base-url=https://api.spotify.com/v1
cityatlas.external.spotify.auth-url=https://accounts.spotify.com/api/token

# Unsplash API - City imagery integration
# Sign up at: https://unsplash.com/developers
# Used for: High-quality city photos, visual content
cityatlas.external.unsplash.access-key=${UNSPLASH_ACCESS_KEY:placeholder-unsplash-key}
cityatlas.external.unsplash.base-url=https://api.unsplash.com

# API Rate Limiting & Retry Configuration
cityatlas.external.retry.max-attempts=3
cityatlas.external.retry.backoff-ms=1000
cityatlas.external.timeout.connection-ms=5000
cityatlas.external.timeout.read-ms=10000

# ============================================
# SPRING CACHE CONFIGURATION
# ============================================
# Cache type: caffeine (in-memory with TTL and eviction)
spring.cache.type=caffeine

# Cache names (defined in CacheConfig.java)
# - weather: Weather API responses (recommended TTL: 10-30 min)
# - airQuality: Air Quality API responses (recommended TTL: 15-30 min)
# - spotifyMetadata: Spotify metadata (recommended TTL: 6-24 hours)
# - cityImages: Unsplash image URLs (recommended TTL: 24 hours)
#
# Note: Simple cache (ConcurrentHashMap) doesn't support TTL configuration.
# For TTL support, use Redis or Caffeine cache.
#
# Redis example (requires spring-boot-starter-data-redis):
# spring.cache.type=redis
# spring.data.redis.host=localhost
# spring.data.redis.port=6379
# spring.cache.redis.time-to-live=600000 (10 minutes in milliseconds)
#
# Caffeine example (requires caffeine dependency):
# spring.cache.type=caffeine
# spring.cache.caffeine.spec=maximumSize=500,expireAfterWrite=10m

# Cache logging — use DEBUG only in application-dev.properties
logging.level.org.springframework.cache=WARN

# ============================================
# TODO: PRODUCTION CONFIGURATION
# ============================================
# For production deployment, override these properties using:
# 1. Environment variables
# 2. External application-prod.properties file
# 3. Spring Cloud Config Server
# 4. Docker secrets / Kubernetes ConfigMaps
#
# Example environment variables:
# SPRING_DATASOURCE_URL=jdbc:postgresql://prod-db:5432/cityatlas
# SPRING_DATASOURCE_USERNAME=${DB_USERNAME}
# SPRING_DATASOURCE_PASSWORD=${DB_PASSWORD}
# SPRING_JPA_SHOW_SQL=false
# LOGGING_LEVEL_COM_CITYATLAS_BACKEND=WARN
